# Isaac Sim ä»¿çœŸç¯å¢ƒæ¶æ„è¯´æ˜

## ä¸€ã€å¯åŠ¨å…³ç³»

### 1.1 ç‹¬ç«‹å¯åŠ¨æœºåˆ¶

**Isaac Sim Flask Server å’Œ RL è®­ç»ƒæ¨¡å—æ˜¯ç‹¬ç«‹å¯åŠ¨çš„**ï¼š

#### Isaac Sim Flask Server å¯åŠ¨
```bash
# åœ¨ä¸»æœº1ï¼ˆä»¿çœŸç¯å¢ƒä¸»æœºï¼‰ä¸Šå¯åŠ¨
python serl_robot_infra/robot_servers/isaac_sim_server.py \
    --flask_url=0.0.0.0 \
    --flask_port=5001 \
    --headless=True \
    --usd_path=/path/to/HIL_franka_gear.usda \
    --robot_prim_path=/World/franka \
    --camera_prim_paths=/World/franka/panda_hand/wrist_1,/World/franka/panda_hand/wrist_2
```

**å¯åŠ¨æµç¨‹**ï¼š
1. å¯åŠ¨ `SimulationApp`ï¼ˆIsaac Sim åº”ç”¨ç¨‹åºï¼‰
2. **åŠ è½½ USD åœºæ™¯æ–‡ä»¶**ï¼ˆåœ¨ `IsaacSimServer.__init__()` ä¸­ï¼‰
3. åˆ›å»º `World` å’Œç‰©ç†å¼•æ“
4. ä»åœºæ™¯ä¸­è·å–æœºå™¨äººã€ç›¸æœºå¯¹è±¡
5. å¯åŠ¨ Flask HTTP æœåŠ¡å™¨
6. å¯åŠ¨ä»¿çœŸå¾ªç¯ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­ï¼‰

#### RL è®­ç»ƒæ¨¡å—å¯åŠ¨
```bash
# åœ¨ä¸»æœº2ï¼ˆè®­ç»ƒä¸»æœºï¼‰ä¸Šå¯åŠ¨
python examples/train_rlpd.py \
    --exp_name=gear_assembly \
    --fake_env=True  # ä½¿ç”¨ä»¿çœŸç¯å¢ƒ
```

**å¯åŠ¨æµç¨‹**ï¼š
1. åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆ`examples/experiments/gear_assembly/config.py`ï¼‰
2. åˆ›å»º Gym ç¯å¢ƒï¼ˆ`IsaacSimGearAssemblyEnvEnhanced`ï¼‰
3. è¿æ¥åˆ° Isaac Sim Flask Serverï¼ˆé€šè¿‡ `SERVER_URL`ï¼‰
4. å¼€å§‹è®­ç»ƒå¾ªç¯

### 1.2 é€šä¿¡æ–¹å¼

ä¸¤è€…é€šè¿‡ **HTTP** åè®®é€šä¿¡ï¼š
- **æ§åˆ¶å‘½ä»¤**ï¼šRL æ¨¡å— â†’ HTTP POST â†’ Flask Server â†’ Isaac Sim API
- **çŠ¶æ€æŸ¥è¯¢**ï¼šRL æ¨¡å— â†’ HTTP POST â†’ Flask Server â†’ è¿”å›çŠ¶æ€ JSON
- **å›¾åƒä¼ è¾“**ï¼šFlask Server â†’ WebSocket â†’ RL æ¨¡å—ï¼ˆå®æ—¶æ¨é€ï¼‰

---

## äºŒã€Isaac Sim ç¨‹åºå¯åŠ¨å’Œåœºæ™¯åŠ è½½

### 2.1 å½“å‰å®ç°ï¼ˆå¯åŠ¨æ—¶åŠ è½½ USDï¼‰

**æ ¹æ®å½“å‰ä»£ç å®ç°**ï¼ŒIsaac Sim ç¨‹åºå¯åŠ¨æ—¶**ç«‹å³åŠ è½½ USD åœºæ™¯**ï¼š

```python
# isaac_sim_server.py çš„ __init__ æ–¹æ³•
def __init__(self, ..., usd_path: Optional[str] = None, ...):
    # 1. å¯åŠ¨ Isaac Sim
    self.simulation_app = SimulationApp(config)
    
    # 2. åŠ è½½ USD åœºæ™¯æ–‡ä»¶ï¼ˆåœ¨å¯åŠ¨æ—¶ç«‹å³åŠ è½½ï¼‰
    usd_context = omni.usd.get_context()
    usd_context.open_stage(usd_path)  # â† è¿™é‡ŒåŠ è½½ USD
    
    # 3. åˆ›å»ºä¸–ç•Œ
    self.world = World(stage_units_in_meters=1.0)
    
    # 4. ä»åœºæ™¯ä¸­è·å–æœºå™¨äººã€ç›¸æœºå¯¹è±¡
    self.franka = self.world.scene.get(robot_prim_path)
    self.cameras = {...}
```

**è¿™æ„å‘³ç€**ï¼š
- âœ… Isaac Sim å¯åŠ¨æ—¶åœºæ™¯**ä¸æ˜¯ç©ºçš„**ï¼Œè€Œæ˜¯**ç«‹å³åŠ è½½äº† USD æ–‡ä»¶**
- âœ… USD æ–‡ä»¶è·¯å¾„é€šè¿‡å‘½ä»¤è¡Œå‚æ•° `--usd_path` æŒ‡å®š
- âœ… åœºæ™¯åŒ…å«æœºå™¨äººã€ç›¸æœºã€ä»»åŠ¡å¯¹è±¡ï¼ˆgear_mediumã€gear_base ç­‰ï¼‰

### 2.2 ç”¨æˆ·æè¿°çš„åœºæ™¯ï¼ˆåŠ¨æ€åŠ è½½ï¼‰

**å¦‚æœç”¨æˆ·å¸Œæœ›å®ç°"å¯åŠ¨æ—¶åœºæ™¯ä¸ºç©ºï¼Œç„¶åé€šè¿‡ RL æ¨¡å—åŠ¨æ€åŠ è½½ USD"**ï¼Œéœ€è¦ï¼š

1. **ä¿®æ”¹ `isaac_sim_server.py`**ï¼š
   - å¯åŠ¨æ—¶ä¸åŠ è½½ USDï¼ˆåœºæ™¯ä¸ºç©ºï¼‰
   - æ·»åŠ  HTTP æ¥å£ `/load_scene` ç”¨äºåŠ¨æ€åŠ è½½ USD

2. **ä¿®æ”¹ RL æ¨¡å—**ï¼š
   - åœ¨ç¯å¢ƒåˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡ HTTP POST è¯·æ±‚åŠ è½½ USD

**ç¤ºä¾‹å®ç°**ï¼ˆå¦‚æœé‡‡ç”¨åŠ¨æ€åŠ è½½æ–¹æ¡ˆï¼‰ï¼š
```python
# isaac_sim_server.py ä¸­æ·»åŠ 
@webapp.route("/load_scene", methods=["POST"])
def load_scene():
    """åŠ¨æ€åŠ è½½ USD åœºæ™¯"""
    usd_path = request.json["usd_path"]
    isaac_sim_server.load_usd_scene(usd_path)
    return "Scene loaded"

# isaac_sim_gear_env_enhanced.py ä¸­
def __init__(self, ...):
    super().__init__(...)
    # åŠ¨æ€åŠ è½½åœºæ™¯
    usd_path = "/path/to/HIL_franka_gear.usda"
    self.session.post(self.url + "load_scene", json={"usd_path": usd_path})
```

**æ³¨æ„**ï¼šå½“å‰ä»£ç **æ²¡æœ‰å®ç°åŠ¨æ€åŠ è½½**ï¼ŒUSD åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å°±å·²ç»åŠ è½½ã€‚

---

## ä¸‰ã€RL è®­ç»ƒæ¨¡å—å‘é€ä»»åŠ¡è®¾ç½®

### 3.1 ä»»åŠ¡é…ç½®ä¼ é€’æµç¨‹

è™½ç„¶å½“å‰å®ç°ä¸­ USD åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åŠ è½½ï¼Œä½†**ä»»åŠ¡ç›¸å…³çš„é…ç½®**ï¼ˆä½å§¿ã€è¾¹ç•Œæ¡†ç­‰ï¼‰æ˜¯é€šè¿‡ RL æ¨¡å—ä¼ é€’çš„ï¼š

#### é…ç½®ä¼ é€’æ–¹å¼

1. **ä½å§¿é…ç½®**ï¼ˆ`TARGET_POSE`ã€`GRASP_POSE`ã€`RESET_POSE`ï¼‰ï¼š
   - å®šä¹‰åœ¨ `examples/experiments/gear_assembly/config.py` çš„ `IsaacSimEnvConfig` ç±»ä¸­
   - é€šè¿‡ `IsaacSimGearAssemblyEnvEnhanced` çš„ `config` å‚æ•°ä¼ é€’
   - **ä¸é€šè¿‡ HTTP å‘é€**ï¼Œåªåœ¨ RL æ¨¡å—å†…éƒ¨ä½¿ç”¨

2. **åŠ¨ä½œå‘½ä»¤**ï¼ˆé€šè¿‡ HTTP å‘é€ï¼‰ï¼š
   ```python
   # isaac_sim_env.py
   def _send_pos_command(self, pos: np.ndarray):
       self.session.post(self.url + "pose", json={"arr": pos.tolist()})
   ```

3. **çŠ¶æ€æŸ¥è¯¢**ï¼ˆé€šè¿‡ HTTP è·å–ï¼‰ï¼š
   ```python
   # isaac_sim_env.py
   def _update_currpos(self):
       response = self.session.post(self.url + "getstate", ...)
       self.currpos = np.array(response.json()["pose"])
   ```

### 3.2 ä»»åŠ¡è®¾ç½®çš„å®é™…ä¼ é€’

**å½“å‰å®ç°ä¸­ï¼Œä»»åŠ¡è®¾ç½®ï¼ˆä½å§¿ã€è¾¹ç•Œæ¡†ç­‰ï¼‰å¹¶ä¸é€šè¿‡ HTTP å‘é€åˆ°æœåŠ¡å™¨**ï¼Œè€Œæ˜¯ï¼š

- âœ… **åœ¨ RL æ¨¡å—å†…éƒ¨ä½¿ç”¨**ï¼šç”¨äºè®¡ç®—å¥–åŠ±ã€é™åˆ¶åŠ¨ä½œç©ºé—´ç­‰
- âœ… **æœåŠ¡å™¨ç«¯ä¸éœ€è¦çŸ¥é“**ï¼šæœåŠ¡å™¨åªè´Ÿè´£æ‰§è¡Œæ§åˆ¶å‘½ä»¤å’Œè¿”å›çŠ¶æ€

**å¦‚æœéœ€è¦åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ä»»åŠ¡é…ç½®**ï¼ˆä¾‹å¦‚ï¼šæœåŠ¡å™¨ç«¯é‡ç½®åˆ°ç‰¹å®šä½ç½®ï¼‰ï¼Œå¯ä»¥ï¼š

1. **é€šè¿‡ HTTP æ¥å£ä¼ é€’**ï¼š
   ```python
   # åœ¨ç¯å¢ƒåˆå§‹åŒ–æ—¶
   self.session.post(self.url + "set_task_config", json={
       "target_pose": self.config.TARGET_POSE.tolist(),
       "grasp_pose": self.config.GRASP_POSE.tolist(),
       ...
   })
   ```

2. **æœåŠ¡å™¨ç«¯å­˜å‚¨é…ç½®**ï¼š
   ```python
   # isaac_sim_server.py
   self.task_config = None
   
   @webapp.route("/set_task_config", methods=["POST"])
   def set_task_config():
       isaac_sim_server.task_config = request.json
       return "Config set"
   ```

**å½“å‰ä»£ç æ²¡æœ‰å®ç°è¿™ä¸ªåŠŸèƒ½**ï¼Œä»»åŠ¡é…ç½®åªåœ¨ RL æ¨¡å—å†…éƒ¨ä½¿ç”¨ã€‚

---

## å››ã€ä¸‰ä¸ªæ–‡ä»¶çš„å…³ç³»

### 4.1 æ–‡ä»¶å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RL è®­ç»ƒæ¨¡å—ï¼ˆä¸»æœº2ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  isaac_sim_gear_env_enhanced.py                      â”‚  â”‚
â”‚  â”‚  (ä»»åŠ¡ç‰¹å®šçš„ç¯å¢ƒå®ç°)                                   â”‚  â”‚
â”‚  â”‚  - ç»§æ‰¿è‡ª isaac_sim_env.py                            â”‚  â”‚
â”‚  â”‚  - æ·»åŠ  gear ç»„è£…ä»»åŠ¡çš„ç‰¹å®šé€»è¾‘                        â”‚  â”‚
â”‚  â”‚  - regrasp()ã€ä»»åŠ¡å¯¹è±¡ç®¡ç†ç­‰                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚ ç»§æ‰¿                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  isaac_sim_env.py                                     â”‚  â”‚
â”‚  â”‚  (Isaac Sim ç¯å¢ƒåŸºç±»)                                  â”‚  â”‚
â”‚  â”‚  - å®ç° Gym æ¥å£ï¼ˆresetã€stepã€_get_obsï¼‰              â”‚  â”‚
â”‚  â”‚  - HTTP å®¢æˆ·ç«¯ï¼ˆå‘é€æ§åˆ¶å‘½ä»¤ã€è·å–çŠ¶æ€ï¼‰                â”‚  â”‚
â”‚  â”‚  - WebSocket å®¢æˆ·ç«¯ï¼ˆæ¥æ”¶å›¾åƒï¼‰                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚ HTTP/WebSocket                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ ç½‘ç»œé€šä¿¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                   ä»¿çœŸç¯å¢ƒæ¨¡å—ï¼ˆä¸»æœº1ï¼‰  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  isaac_sim_server.py                                  â”‚  â”‚
â”‚  â”‚  (Isaac Sim Flask æœåŠ¡å™¨)                              â”‚  â”‚
â”‚  â”‚  - ç®¡ç† Isaac Sim åº”ç”¨ç¨‹åº                             â”‚  â”‚
â”‚  â”‚  - åŠ è½½ USD åœºæ™¯æ–‡ä»¶                                   â”‚  â”‚
â”‚  â”‚  - æä¾› HTTP æ¥å£ï¼ˆ/poseã€/getstate ç­‰ï¼‰               â”‚  â”‚
â”‚  â”‚  - æä¾› WebSocket æ¥å£ï¼ˆå›¾åƒæ¨é€ï¼‰                      â”‚  â”‚
â”‚  â”‚  - æ‰§è¡Œæ§åˆ¶å‘½ä»¤ï¼ˆè°ƒç”¨ Isaac Sim APIï¼‰                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚ Isaac Sim API                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Isaac Sim åº”ç”¨ç¨‹åº                                    â”‚  â”‚
â”‚  â”‚  - SimulationApp                                     â”‚  â”‚
â”‚  â”‚  - Worldã€Frankaã€Camera                              â”‚  â”‚
â”‚  â”‚  - ç‰©ç†å¼•æ“ã€æ¸²æŸ“å¼•æ“                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¯¦ç»†å…³ç³»è¯´æ˜

#### 4.2.1 `isaac_sim_server.py`ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

**èŒè´£**ï¼š
- âœ… å¯åŠ¨å’Œç®¡ç† Isaac Sim åº”ç”¨ç¨‹åº
- âœ… åŠ è½½ USD åœºæ™¯æ–‡ä»¶ï¼ˆåœ¨ `__init__` ä¸­ï¼‰
- âœ… ç®¡ç†æœºå™¨äººã€ç›¸æœºå¯¹è±¡
- âœ… æä¾› HTTP æ¥å£ï¼ˆ`/pose`ã€`/getstate`ã€`/close_gripper` ç­‰ï¼‰
- âœ… æä¾› WebSocket æ¥å£ï¼ˆå›¾åƒæ¨é€ï¼‰
- âœ… æ‰§è¡Œæ§åˆ¶å‘½ä»¤ï¼ˆè°ƒç”¨ Isaac Sim APIï¼‰
- âœ… æŒç»­æ›´æ–°çŠ¶æ€ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­ï¼‰

**å…³é”®ä»£ç **ï¼š
```python
class IsaacSimServer:
    def __init__(self, ..., usd_path: str, ...):
        # 1. å¯åŠ¨ Isaac Sim
        self.simulation_app = SimulationApp(config)
        
        # 2. åŠ è½½ USD åœºæ™¯ï¼ˆå¯åŠ¨æ—¶åŠ è½½ï¼‰
        usd_context.open_stage(usd_path)
        
        # 3. åˆ›å»ºä¸–ç•Œ
        self.world = World(...)
        
        # 4. è·å–æœºå™¨äººã€ç›¸æœº
        self.franka = self.world.scene.get(robot_prim_path)
        self.cameras = {...}
        
        # 5. å¯åŠ¨ä»¿çœŸå¾ªç¯ï¼ˆåå°çº¿ç¨‹ï¼‰
        self._start_simulation_loop()
```

#### 4.2.2 `isaac_sim_env.py`ï¼ˆå®¢æˆ·ç«¯åŸºç±»ï¼‰

**èŒè´£**ï¼š
- âœ… å®ç° Gym ç¯å¢ƒæ¥å£ï¼ˆ`reset()`ã€`step()`ã€`observation_space` ç­‰ï¼‰
- âœ… HTTP å®¢æˆ·ç«¯ï¼ˆå‘é€æ§åˆ¶å‘½ä»¤ã€è·å–çŠ¶æ€ï¼‰
- âœ… WebSocket å®¢æˆ·ç«¯ï¼ˆæ¥æ”¶å›¾åƒæ•°æ®ï¼‰
- âœ… ä¸ `isaac_sim_server.py` é€šä¿¡ï¼ˆé€šè¿‡ HTTP/WebSocketï¼‰

**å…³é”®ä»£ç **ï¼š
```python
class IsaacSimFrankaEnv(gym.Env):
    def __init__(self, config: DefaultEnvConfig, ...):
        # 1. ä¿å­˜æœåŠ¡å™¨ URL
        self.url = config.SERVER_URL  # ä¾‹å¦‚ï¼šhttp://127.0.0.1:5001/
        
        # 2. åˆ›å»º HTTP ä¼šè¯
        self.session = requests.Session()
        
        # 3. è¿æ¥ WebSocketï¼ˆç”¨äºå›¾åƒï¼‰
        self._connect_websocket()
        
        # 4. åˆå§‹åŒ–çŠ¶æ€
        self._update_currpos()
    
    def step(self, action):
        # 1. å‘é€æ§åˆ¶å‘½ä»¤ï¼ˆHTTP POSTï¼‰
        self._send_pos_command(target_pose)
        self._send_gripper_command(gripper_action)
        
        # 2. æ›´æ–°çŠ¶æ€ï¼ˆHTTP POSTï¼‰
        self._update_currpos()
        
        # 3. è·å–è§‚å¯Ÿï¼ˆä» WebSocket ç¼“å­˜ï¼‰
        obs = self._get_obs()
        
        # 4. è®¡ç®—å¥–åŠ±ï¼ˆæœ¬åœ°è®¡ç®—ï¼‰
        reward = self.compute_reward(obs)
        
        return obs, reward, done, False, info
```

#### 4.2.3 `isaac_sim_gear_env_enhanced.py`ï¼ˆä»»åŠ¡ç‰¹å®šå®ç°ï¼‰

**èŒè´£**ï¼š
- âœ… ç»§æ‰¿è‡ª `isaac_sim_env.py`
- âœ… æ·»åŠ  Gear ç»„è£…ä»»åŠ¡çš„ç‰¹å®šé€»è¾‘
- âœ… é‡æ–°æŠ“å–åŠŸèƒ½ï¼ˆ`regrasp()`ï¼‰
- âœ… ä»»åŠ¡ç‰¹å®šçš„é‡ç½®é€»è¾‘ï¼ˆ`reset()`ï¼‰
- âœ… ä»»åŠ¡å¯¹è±¡ç®¡ç†ï¼ˆ`gear_medium`ã€`gear_base` ç­‰ï¼‰

**å…³é”®ä»£ç **ï¼š
```python
class IsaacSimGearAssemblyEnvEnhanced(IsaacSimFrankaEnv):
    def __init__(self, ...):
        # 1. ä»»åŠ¡å¯¹è±¡å¼•ç”¨
        self.gear_medium = None
        self.gear_base = None
        
        # 2. è°ƒç”¨åŸºç±»åˆå§‹åŒ–ï¼ˆå»ºç«‹ HTTP/WebSocket è¿æ¥ï¼‰
        super().__init__(**kwargs)
        
        # 3. è®¾ç½®é”®ç›˜ç›‘å¬ï¼ˆF1 è§¦å‘é‡æ–°æŠ“å–ï¼‰
        self.keyboard_listener = ...
    
    def reset(self, **kwargs):
        # 1. æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æŠ“å–
        if self.should_regrasp:
            self.regrasp()
        
        # 2. è°ƒç”¨åŸºç±»é‡ç½®ï¼ˆç§»åŠ¨åˆ° RESET_POSEï¼‰
        self.go_to_reset()
        
        # 3. è·å–è§‚å¯Ÿ
        obs = self._get_obs()
        
        return obs, {}
    
    def regrasp(self):
        # ä»»åŠ¡ç‰¹å®šçš„é‡æ–°æŠ“å–é€»è¾‘
        # ä½¿ç”¨åŸºç±»çš„ HTTP æ¥å£å‘é€æ§åˆ¶å‘½ä»¤
        self._send_pos_command(...)
        self._send_gripper_command(...)
```

### 4.3 æ•°æ®æµå‘

#### æ§åˆ¶å‘½ä»¤æµå‘
```
RL è®­ç»ƒæ¨¡å—
  â†“ (è°ƒç”¨ step(action))
isaac_sim_gear_env_enhanced.py
  â†“ (è°ƒç”¨åŸºç±»æ–¹æ³•)
isaac_sim_env.py
  â†“ (HTTP POST /pose)
isaac_sim_server.py
  â†“ (è°ƒç”¨ Isaac Sim API)
Isaac Sim åº”ç”¨ç¨‹åº
  â†“ (æ‰§è¡ŒåŠ¨ä½œ)
ç‰©ç†å¼•æ“æ›´æ–°çŠ¶æ€
```

#### çŠ¶æ€æŸ¥è¯¢æµå‘
```
RL è®­ç»ƒæ¨¡å—
  â†“ (è°ƒç”¨ _get_obs())
isaac_sim_gear_env_enhanced.py
  â†“ (è°ƒç”¨åŸºç±»æ–¹æ³•)
isaac_sim_env.py
  â†“ (HTTP POST /getstate)
isaac_sim_server.py
  â†“ (è¿”å›ç¼“å­˜çš„çŠ¶æ€)
isaac_sim_env.py
  â†“ (ç»„åˆè§‚å¯Ÿ)
RL è®­ç»ƒæ¨¡å—
```

#### å›¾åƒæ•°æ®æµå‘
```
Isaac Sim åº”ç”¨ç¨‹åº
  â†“ (æ¸²æŸ“å›¾åƒ)
isaac_sim_server.py
  â†“ (WebSocket æ¨é€)
isaac_sim_env.py
  â†“ (ç¼“å­˜åˆ° image_cache)
isaac_sim_gear_env_enhanced.py
  â†“ (è·å–è§‚å¯Ÿ)
RL è®­ç»ƒæ¨¡å—
```

---

## äº”ã€æ€»ç»“

### 5.1 å¯åŠ¨å…³ç³»
- âœ… **Isaac Sim Flask Server å’Œ RL è®­ç»ƒæ¨¡å—ç‹¬ç«‹å¯åŠ¨**
- âœ… **Isaac Sim ç¨‹åºç”± `isaac_sim_server.py` å¯åŠ¨**
- âš ï¸ **å½“å‰å®ç°ï¼šå¯åŠ¨æ—¶ç«‹å³åŠ è½½ USDï¼ˆåœºæ™¯ä¸æ˜¯ç©ºçš„ï¼‰**
- ğŸ’¡ **å¦‚æœå¸Œæœ›åŠ¨æ€åŠ è½½ï¼šéœ€è¦ä¿®æ”¹ä»£ç æ·»åŠ  `/load_scene` æ¥å£**

### 5.2 ä»»åŠ¡è®¾ç½®ä¼ é€’
- âœ… **ä½å§¿é…ç½®åœ¨ RL æ¨¡å—å†…éƒ¨ä½¿ç”¨**ï¼ˆä¸é€šè¿‡ HTTP å‘é€ï¼‰
- âœ… **æ§åˆ¶å‘½ä»¤é€šè¿‡ HTTP å‘é€**ï¼ˆ`/pose`ã€`/close_gripper` ç­‰ï¼‰
- âœ… **çŠ¶æ€é€šè¿‡ HTTP è·å–**ï¼ˆ`/getstate`ï¼‰
- âœ… **å›¾åƒé€šè¿‡ WebSocket æ¨é€**ï¼ˆå®æ—¶ä¼ è¾“ï¼‰

### 5.3 ä¸‰ä¸ªæ–‡ä»¶çš„å…³ç³»
- âœ… **`isaac_sim_server.py`**ï¼šæœåŠ¡å™¨ç«¯ï¼Œç®¡ç† Isaac Simï¼Œæä¾› HTTP/WebSocket æ¥å£
- âœ… **`isaac_sim_env.py`**ï¼šå®¢æˆ·ç«¯åŸºç±»ï¼Œå®ç° Gym æ¥å£ï¼Œé€šè¿‡ HTTP/WebSocket ä¸æœåŠ¡å™¨é€šä¿¡
- âœ… **`isaac_sim_gear_env_enhanced.py`**ï¼šä»»åŠ¡ç‰¹å®šå®ç°ï¼Œç»§æ‰¿åŸºç±»ï¼Œæ·»åŠ  Gear ç»„è£…ä»»åŠ¡é€»è¾‘

### 5.4 æ¶æ„ä¼˜åŠ¿
- âœ… **åˆ†ç¦»éƒ¨ç½²**ï¼šä»¿çœŸç¯å¢ƒå’Œè®­ç»ƒæ¨¡å—å¯ä»¥åœ¨ä¸åŒä¸»æœºä¸Šè¿è¡Œ
- âœ… **æ¥å£ä¸€è‡´**ï¼šä¸çœŸå®ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„ HTTP æ¥å£
- âœ… **ä»£ç å¤ç”¨**ï¼šè®­ç»ƒä»£ç å®Œå…¨å¤ç”¨ï¼Œåªéœ€åˆ‡æ¢ç¯å¢ƒ
- âœ… **å®æ—¶é€šä¿¡**ï¼šWebSocket å®ç°ä½å»¶è¿Ÿå›¾åƒä¼ è¾“
